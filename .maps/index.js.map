{"version":3,"sources":["index.es7.js"],"names":[],"mappings":"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","file":"index.es7.js","sourcesContent":["/**\n * Created by Denis Bondarenko <bond.den@gmail.com> on 14.08.2015.\n */\n\"use strict\";\n\nvar\n\tImap        = require('imap'),\n\ticonv       = require('iconv'),\n\tMailParser  = require(\"mailparser\").MailParser,\n\tinspect     = require('util').inspect,\n\tpath        = require('path'),\n\tfs          = require('fs-extra')\n;\n\nimport * as modBsc from '@bond007/esf-bsc';\nimport * as modUtl from '@bond007/esf-utl';\n\nvar\n\tUtl=modUtl.Utl,\n\tL  =Utl.log,\n  E  =Utl.rejectingError\n;\n\nexport class EmlRcv extends modBsc.Bsc {\n\n\tconstructor(){\n\t\tsuper();\n\t\tthis.stat={\n\t\t\t\"operationDate\":\"\",\n\t\t\t\"operationDir\":\"\",\n\t\t\t\"messagesFound\":0,\n\t\t\t\"withAttachments\":0,\n\t\t\t\"filesReceived\":0,\n\t\t\t\"sendersTotal\":0,\n\t\t\t\"receivedFromSendersNum\":0,\n\t\t\t\"attachmentsReceived\":0,\n\t\t\t\"attachmentsSaved\":0,\n\t\t\t\"attLog\":[],\n\t\t\t\"settings\":{}\n\t\t};\n\t}\n\n\tgetCurrentDateTime(){\n\t\treturn Utl.getCurrentDateFmtFFS();\n\t}\n\n\tcreateFolders(folderName){\n\t\tvar H=this;\n\t\treturn new Promise(function(rs,rj){\n\n\t\t\tlet operationDir=path.resolve(__dirname+'/'+H.cfg.local.path+folderName);\n\t\t\tfs.ensureDir(operationDir,function(e){\n\n\t\t\t\tif(e){\n\t\t\t\t\treturn E(1,'Error creating dir '+operationDir,e,rj);\n\t\t\t\t}\n\n\t\t\t\tH.stat.operationDir=operationDir;\n\n\t\t\t\tL(H.stat.operationDir);\n\n\t\t\t\tlet wtr=[];\n\t\t\t\tfor(let [subDirId,subDirName] of Object.entries(H.cfg.local.subDirs)){\n\n\t\t\t\t\twtr.push(\n\t\t\t\t\t\tnew Promise(function(rs1,rj1){\n\n\t\t\t\t\t\t\tlet subDir=path.resolve(operationDir+'/'+subDirName);\n\t\t\t\t\t\t\tfs.ensureDir(subDir,function(e1){\n\n\t\t\t\t\t\t\t\tif(e1){\n\t\t\t\t\t\t\t\t\treturn E(2,'Error creating dir '+subDir,e1,rj1);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\trs1(subDir);\n\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t\tPromise.all(wtr).then(function(rw){\n\t\t\t\t\trs(rw.push(operationDir));\n\t\t\t\t}).catch(function(ew){\n\t\t\t\t\tE(3,'',ew,rj);\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t});\n\t}\n\n\t//todo: implement esf-eml-rcv-0.3\n\tprocessMessage(msgId,buffer,opDir){\n\t\tvar H=this;\n\t\treturn new Promise(function(rs,rj){\n\n\t\t\tfunction detectAttachmentType(s){\n\t\t\t\tlet a=s.split('/');\n\t\t\t\treturn (Array.isArray(a) && a.length==2)?a[1]:'';\n\t\t\t}\n\n\t\t\tlet file=path.resolve(opDir+'/'+H.cfg.local.subDirs.raw+msgId+'.eml');\n\t\t\tlet psr = new MailParser();\n\t\t\tlet wtr=[];\n\n\t\t\tpsr.on(\"end\", function(eml){\n\n\t\t\t\tlet attLogItem={\n\t\t\t\t\t\"msgId\":msgId,\n\t\t\t\t\t\"from\":eml.from,\n\t\t\t\t\t\"subj\":eml.subject,\n\t\t\t\t\t\"date\":eml.date,\n\t\t\t\t\t\"att\":[]\n\t\t\t\t};\n\n\t\t\t\tL('#'+msgId+' attachments:','em');\n\n\t\t\t\t//fs.writeFileSync(path.resolve(opDir+'/e0/'+msgId+'.json'),JSON.stringify(eml,null,'\\t'),{encoding:\"utf8\"});\n\n\t\t\t\tif(eml.attachments && eml.attachments.length){\n\n\t\t\t\t\tH.stat.withAttachments++;\n\n\t\t\t\t\teml.attachments.forEach(function(att,i,a){\n\t\t\t\t\t\tL('Msg '+msgId+' has attachment: '+att.fileName);\n\n\t\t\t\t\t\tlet fileData={\n\t\t\t\t\t\t\t\"ext\":       path.extname(att.fileName),\n\t\t\t\t\t\t\t\"base\":      opDir+'/'+H.cfg.local.subDirs.att+msgId+'-'+i,\n\t\t\t\t\t\t\t\"type\":      detectAttachmentType(att.contentType),\n\t\t\t\t\t\t\t\"name\":      att.fileName,\n\t\t\t\t\t\t\t\"namGen\":    att.generatedFileName,\n\t\t\t\t\t\t\t\"tEncoding\": att.transferEncoding,\n\t\t\t\t\t\t\t\"length\":    att.length,\n\t\t\t\t\t\t\t\"checksum\":  att.checksum\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tH.stat.attachmentsReceived++;\n\n\t\t\t\t\t\tlet filePath=path.resolve(fileData.base+fileData.ext);\n\n\t\t\t\t\t\tif(H.cfg.rules.attachmentSubtypes.indexOf(fileData.type)===-1)return;\n\n\t\t\t\t\t\twtr.push(new Promise(function(rsa,rja){\n\n\t\t\t\t\t\t\tL('Saving attachment '+filePath);\n\n\t\t\t\t\t\t\tfs.writeFile(\n\t\t\t\t\t\t\t\tfilePath,\n\t\t\t\t\t\t\t  att.content,\n\t\t\t\t\t\t\t\t{encoding:\"utf8\"},\n\t\t\t\t\t\t\t  function(ea){\n\n\t\t\t\t\t\t\t\t  if(ea){\n\t\t\t\t\t\t\t\t\t  return E(101,'Error saving attachment '+filePath,ea,rja);\n\t\t\t\t\t\t\t\t  }\n\n\t\t\t\t\t\t\t\t  attLogItem.att.push(fileData);\n\t\t\t\t\t\t\t\t  H.stat.attachmentsSaved++;\n\t\t\t\t\t\t\t\t  rsa(filePath);\n\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t});\n\n\t\t\t\t}else{\n\t\t\t\t\twtr.push(new Promise(function(rsw,rjw){\n\t\t\t\t\t\trsw(true);\n\t\t\t\t\t}));\n\t\t\t\t}\n\n\t\t\t\tPromise.all(wtr).then(function(rw){\n\n\t\t\t\t\tH.stat.attLog.push(attLogItem);\n\n\t\t\t\t\trs(msgId);\n\t\t\t\t}).catch(function(ew){\n\t\t\t\t\tE(102,'Error processing msg '+msgId,ew,rj);\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\tfs.writeFile(file,buffer,{encoding:\"utf8\"},function(ef){\n\n\t\t\t\tif(ef){\n\t\t\t\t\treturn E(4,'Error saving raw eml '+file,ef,rj);\n\t\t\t\t}\n\n\t\t\t\tL(file+'\\twritten');\n\n\t\t\t\tfs.createReadStream(file).pipe(psr);\n\n\t\t\t});\n\n\t\t});\n\t}\n\n\tinitMailBox(){\n\t\tvar H=this;\n\t\treturn new Promise(function(rs,rj){\n\n\t\t\ttry{\n\n\t\t\t\tvar imap=new Imap(H.cfg.imap);\n\n\t\t\t\t//L('Imap:\\n'+JSON.stringify(imap,null,'\\t'));\n\n\t\t\t\timap.once('ready',function(){\n\t\t\t\t\timap.openBox('INBOX',true,function(e1,box){\n\n\t\t\t\t\t\tif(e1){\n\t\t\t\t\t\t\treturn E(5,'Error opening mail box',e1,rj);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//L('Inbox opened. box: '+JSON.stringify(box,null,'\\t'));\n\n\t\t\t\t\t\trs(imap);\n\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\timap.once('error',function(e2){\n\t\t\t\t\tE(10,'IMAP Error',e2,rj);\n\t\t\t\t});\n\n\t\t\t\timap.once('end',function(){\n\t\t\t\t\tL('Connection ended');\n\t\t\t\t\t//rs('ok','em');\n\t\t\t\t});\n\n\t\t\t\timap.connect();\n\n\t\t\t}catch(e0){\n\t\t\t\tE(205,'Error opening initiating Mailbox',e0,rj);\n\t\t\t}\n\n\t\t});\n\t}\n\n\tcheckMail(imap){\n\t\tvar H=this;\n\t\treturn new Promise(function(rs,rj){\n\n\t\t\timap.search(\n\t\t\t\t[\n\t\t\t\t\t'UNSEEN',\n\t\t\t\t\t['SINCE', H.cfg.rules.dateRange.since],\n\t\t\t\t\t['BEFORE', H.cfg.rules.dateRange.till]\n\t\t\t\t],\n\t\t\t\tfunction(e4,searchResult){\n\n\t\t\t\t\tif(e4){\n\t\t\t\t\t\tE(6,'Error searching messages',e4,rj,true);\n\t\t\t\t\t}\n\n\t\t\t\t\tH.stat.messagesFound=searchResult.length;\n\n\t\t\t\t\trs(searchResult);\n\n\t\t\t\t}\n\t\t\t);\n\n\t\t});\n\t}\n\n\treceiveMail(operationDir,searchResult,imap){\n\t\tvar H=this;\n\t\treturn new Promise(function(rs,rj){\n\n\t\t\tlet f=imap.seq.fetch(searchResult,{\n\t\t\t\tbodies:'',\n\t\t\t\tstruct:true\n\t\t\t});\n\n\t\t\tlet wtr=[\n\t\t\t\tnew Promise(function(rst,rjt){\n\t\t\t\t\trst(true);\n\t\t\t\t})\n\t\t\t];\n\n\t\t\tf.on('message',function(msg,num){\n\n\t\t\t\tL('Message #'+num);\n\n\t\t\t\tmsg.on('body',function(stream,info){\n\n\t\t\t\t\tvar buffer='';\n\t\t\t\t\tstream.on('data',function(chunk){\n\t\t\t\t\t\tbuffer+=chunk.toString('utf8');\n\t\t\t\t\t});\n\n\t\t\t\t\tstream.once('end',function(){\n\t\t\t\t\t\twtr.push(H.processMessage(num,buffer,operationDir));\n\t\t\t\t\t\timap.end();\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t\tmsg.once('end',function(){\n\t\t\t\t\tL('Finished fetching msg '+num);\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\tf.once('error',function(e3){\n\t\t\t\tE(7,'Fetch error',e3);\n\t\t\t});\n\n\t\t\tf.once('end',function(){\n\n\t\t\t\tL('Done fetching all messages');\n\t\t\t\timap.end();\n\n\t\t\t\tPromise.all(wtr).then(function(rw){\n\n\t\t\t\t\tL('Done processing fetched messages.\\nSaving stat...');\n\n\t\t\t\t\tfs.writeJson(H.stat.operationDir+'/stt.json',H.stat,function(es){\n\n\t\t\t\t\t\tif(es){\n\t\t\t\t\t\t\treturn E(8,'Fetch error',es,rj);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tL('Stat saved','em');\n\t\t\t\t\t\trs('Stat saved');\n\n\t\t\t\t\t});\n\n\t\t\t\t}).catch(function(ew){\n\t\t\t\t\tE(9,'Fetch error',ew,rj);\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t});\n\t}\n\n\tsplitMessagesRangeAndFetch(operationDir,searchResult,imap){\n\t\tvar H=this;\n\t\treturn new Promise(function(rs,rj){\n\n\t\t\tif(!operationDir){\n\t\t\t\treturn E(207,'No folder to save attachments set');\n\t\t\t}\n\n\t\t\tif(searchResult.length===0){\n\t\t\t\tH.stat.messagesFound=0;\n\t\t\t\tL('0 new messages found');\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\t//let tmr=null;\n\t\t\tlet wtr=[];\n\n\t\t\tlet i=1;\n\t\t\tlet l=Math.ceil(searchResult.length/H.cfg.pcs.portion);\n\t\t\twhile(searchResult.length>0){\n\t\t\t\tlet portion=searchResult.splice(0,H.cfg.pcs.portion);\n\t\t\t\tL('Fetching portion: '+i+' of '+l);\n\t\t\t\twtr.push(H.receiveMail(operationDir,portion,imap));\n\t\t\t\t//tmr=setTimeout(function(){\n\t\t\t\t//\tL('Fetching portion: '+portion);\n\t\t\t\t//\twtr.push(H.receiveMail(operationDir,portion));\n\t\t\t\t//},H.cfg.pcs.interPortionDelayMs);\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\tPromise.all(wtr).then(function(rw){\n\t\t\t\trs('All Portions fetched succssfully');\n\t\t\t}).catch(function(ew){\n\t\t\t\tE(208,'Error fetching portion ',ew,rj);\n\t\t\t});\n\n\t\t});\n\t}\n\n\trun(){\n\n\t\tvar H=this;\n\n\t\treturn new Promise(function(rsT,rjT){\n\n\t\t\tL('Loading config...');\n\n\t\t\tH.loadConfig().then(function(cfg){\n\n\t\t\t\tL('Successfully loaded config');\n\t\t\t\t//L(H.cfg);\n\n\t\t\t\tH.stat.operationDate=H.getCurrentDateTime();\n\t\t\t\tH.stat.sendersTotal=H.cfg.rules.from.list.length;\n\n\t\t\t\tlet timeoutTrigger=new Promise(function(rs,rj){\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\trj(new Error('Timeout '+H.cfg.pcs.totalTimeout+' exceeded'));\n\t\t\t\t\t},H.cfg.pcs.totalTimeout);\n\t\t\t\t});\n\n\t\t\t\tlet mainFlow=new Promise(function(rs,rj){\n\n\t\t\t\t\tL('Operation date: '+H.stat.operationDate);\n\t\t\t\t\tL('Cleaning caches...');\n\n\t\t\t\t\t//todo: implement clearPaths bool\n\t\t\t\t\tfs.emptyDir(path.resolve(__dirname+'/'+H.cfg.local.path),function(e5){\n\n\t\t\t\t\t\tif(e5){\n\t\t\t\t\t\t\treturn E(11,'Error cleaning dirs',e5,rj);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tL('Cleaning caches: ready');\n\t\t\t\t\t\tL('Creating tmp folders...');\n\n\t\t\t\t\t\tH.createFolders(H.stat.operationDate).then(function(dirs){\n\n\t\t\t\t\t\t\tL('Tmp folder created: '+JSON.stringify(dirs));\n\t\t\t\t\t\t\tL('Initializing  MailBox...');\n\n\t\t\t\t\t\t\tH.initMailBox().then(function(imap){\n\n\t\t\t\t\t\t\t\tL('MailBox initialized');\n\t\t\t\t\t\t\t\tL('Checking mail...');\n\n\t\t\t\t\t\t\t\tH.checkMail(imap).then(function(searchResult){\n\n\t\t\t\t\t\t\t\t\tL('Mail checked. Found '+searchResult.length+' messages');\n\t\t\t\t\t\t\t\t\tL('Fetching mail...');\n\n\t\t\t\t\t\t\t\t\tH.splitMessagesRangeAndFetch(H.stat.operationDir,searchResult,imap).then(function(rf){\n\n\t\t\t\t\t\t\t\t\t\tL('Mail successfully fetched');\n\t\t\t\t\t\t\t\t\t\trs(rf);\n\n\t\t\t\t\t\t\t\t\t}).catch(function(e5){\n\t\t\t\t\t\t\t\t\t\tE(16,'Error fetching mail',e5,rj);\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t}).catch(function(e4){\n\t\t\t\t\t\t\t\t\tE(15,'Error checking mail',e4,rj);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t}).catch(function(e3){\n\t\t\t\t\t\t\t\tE(12,'Error initializing MailBox',e3,rj);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t}).catch(function(e2){\n\t\t\t\t\t\t\tE(13,'Error creating folders',e2,rj);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t\tPromise.race([\n\t\t\t\t\tmainFlow,\n\t\t\t\t\ttimeoutTrigger\n\t\t\t\t]).then(function(rT){\n\t\t\t\t\trsT(rT);\n\t\t\t\t}).catch(function(eT){\n\t\t\t\t\tE(20,'',eT,rjT);\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t});\n\n\t}\n\n}\n"],"sourceRoot":"/source/"}